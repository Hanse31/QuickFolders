<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta name="robots" content="noindex,noarchive,nofollow">
    <title>Bug 26276 &ndash; Reply template is broken in version 1.3+</title>


<link rel="Top" href="https://www.mozdev.org/bugs/">

  

  


  
    <link rel="Show" title="Dependency Tree"
          href="https://www.mozdev.org/bugs/showdependencytree.cgi?id=26276&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="https://www.mozdev.org/bugs/showdependencygraph.cgi?id=26276">


      <link rel="Show" title="Bug Activity"
            href="https://www.mozdev.org/bugs/show_activity.cgi?id=26276">
      <link rel="Show" title="Printer-Friendly Version"
            href="https://www.mozdev.org/bugs/show_bug.cgi?format=multiple&amp;id=26276">


    

    <script type="text/javascript">
  <!--
  
  function initHelp() {}
  // -->
  </script>

    

    
      <link href="https://www.mozdev.org/bugs/skins/standard/global.css"
            rel="stylesheet"
            type="text/css">
    <!--[if IE]>
      
      <link href="skins/standard/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
        <link href="https://www.mozdev.org/bugs/skins/standard/global.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <!--[if IE]>
        
        <link href="skins/standard/IE-fixes.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <![endif]-->

    

    

    
        <link href="https://www.mozdev.org/bugs/skins/custom/global.css" rel="stylesheet" type="text/css">
    <!--[if IE]>
      
      <link href="skins/custom/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    <link href="https://www.mozdev.org/sharedimages/mozdev-icon.png" rel="icon" type="image/png">
    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozdev" href="https://www.mozdev.org/bugs/search_plugin.cgi">
                                          
  </head>



  <body onload=""
        class="www-mozdev-org-bugs bz_bug bz_status_RESOLVED bz_component_General bz_bug_26276">




<div id="header">
<div id="banner">
  </div>

<div id="mozdev-logolet">
<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla@Mozdev &ndash; Bug&nbsp;26276</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Reply template is broken in version 1.3+</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2016-09-12 11:09:54</p>
    </td>
</tr>
</table>
</div>

<ul class="links">
  <li><a href="https://www.mozdev.org/bugs/">Home</a></li>
  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="https://www.mozdev.org/bugs/buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_top"></form></li>

  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/report.cgi">Reports</a></li>

  <li>
    <span class="separator">| </span>
      <a href="https://www.mozdev.org/bugs/request.cgi">Requests</a></li>


      <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/createaccount.cgi">New&nbsp;Account</a></li>
      



      

        
      <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/show_bug.cgi?id=26276&amp;GoAheadAndLogIn=1">Log&nbsp;In</a></li>
</ul>

</div>

<div id="bugzilla-body">

<i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>

<hr>
<script type="text/javascript">
  <!--

  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
      document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                     id + ');">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id) {
      /* pre id="comment_name_N" */
      var text_elem = document.getElementById('comment_text_'+id);
      var text = getText(text_elem);

      /* make sure we split on all newlines -- IE or Moz use \r and \n
       * respectively.
       */
      text = text.split(/\r|\n/);

      var replytext = "";
      for (var i=0; i < text.length; i++) {
          replytext += "> " + text[i] + "\n"; 
      }

      replytext = "(In reply to comment #" + id + ")\n" + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  function updateCommentTagControl(checkbox, form) {
      if (checkbox.checked) {
          form.comment.className='bz_private';
      } else {
          form.comment.className='';
      }
  }

  //-->
  </script>

<form name="changeform" method="post" action="https://www.mozdev.org/bugs/process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2016-09-12 11:09:54">
  <input type="hidden" name="longdesclength" value="11">
  <input type="hidden" name="id" value="26276">

  
  <table>
    <tr>
      <td valign="top">
        <fieldset>
          <legend>Details</legend>
          <table>

            
            <tr>
              <td align="right">
                <label for="short_desc" accesskey="s"><b><u>S</u>ummary</b></label>:
              </td><td colspan="2">
       <input type="hidden" name="short_desc" id="short_desc"
              value="Reply template is broken in version 1.3+">Reply template is broken in version 1.3+
  </td>
            </tr>

            <tr>
              <td colspan="3">
                <table>
                  <tr>
                    
                    <td valign="top"><table cellspacing="1" cellpadding="1">
    <tr>
      <td align="right">
        <b>Bug#</b>:
      </td>
      <td>
        <a href="show_bug.cgi@id=26276.html">26276</a>
      </td>
    </tr>


    <tr>
      <td align="right">
        <label for="product" accesskey="p"><b><u>P</u>roduct</b></label>:
      </td><td>
      <input type="hidden" id="product" name="product" value="smarttemplate4">smarttemplate4
  </td>
    </tr>

    <tr>
      <td align="right">
        <label for="component" accesskey="m"><b><a href="https://www.mozdev.org/bugs/describecomponents.cgi?product=smarttemplate4">Co<u>m</u>ponent</a></b></label>:
      </td><td>
      <input type="hidden" id="component" name="component" value="General">General
  </td>
    </tr>

    <tr>
      <td align="right">
        <b><a href="https://www.mozdev.org/bugs/page.cgi?id=fields.html#status">Status</a></b>:
      </td>
      <td>RESOLVED</td>
    </tr>

    <tr>
      <td align="right">
        <b><a href="https://www.mozdev.org/bugs/page.cgi?id=fields.html#resolution">Resolution</a></b>:
      </td>
      <td>DUPLICATE
          of bug <span class="bz_closed"><a href="show_bug.cgi@id=26261.html" title="RESOLVED FIXED - Quote header not inserted in plain text mode">26261</a></span>
      </td>
    </tr>
  </table></td>

                    
                    <td valign="top"><table cellspacing="1" cellpadding="1">
    <tr>
      <td align="right">
        <label for="rep_platform" accesskey="h"><b><u>H</u>ardware</b></label>:
      </td><td>
      <input type="hidden" id="rep_platform" name="rep_platform" value="PC">PC
  </td>
    </tr>

    <tr>
      <td align="right">
        <label for="op_sys" accesskey="o"><b><u>O</u>S</b></label>:
      </td><td>
      <input type="hidden" id="op_sys" name="op_sys" value="Windows NT">Windows NT
  </td>
    </tr>

    <tr>
      <td align="right">
        <label for="version"><b>Version</b></label>:
      </td><td>
      <input type="hidden" id="version" name="version" value="unspecified">unspecified
  </td>
    </tr>

    <tr>
      <td align="right">
        <label for="priority" accesskey="i"><b><a href="https://www.mozdev.org/bugs/page.cgi?id=fields.html#priority">Pr<u>i</u>ority</a></b></label>:
      </td><td>
      <input type="hidden" id="priority" name="priority" value="P2">P2
  </td>
    </tr>

    <tr>
      <td align="right">
        <label for="bug_severity"><b><a href="https://www.mozdev.org/bugs/page.cgi?id=fields.html#bug_severity">Severity</a></b></label>:
      </td><td>
      <input type="hidden" id="bug_severity" name="bug_severity" value="normal">normal
  </td>
    </tr>

      <tr>
        <td align="right">
          <label for="target_milestone"><b>
            Target Milestone</b></label>:
        </td><td>
      <input type="hidden" id="target_milestone" name="target_milestone" value="---">---
  </td>
      </tr>
  </table></td>
                  </tr>
                </table>
              </td>
            </tr>

            <tr>
              <td colspan="3"><hr size="1"></td>
            </tr>

            

            <tr>
              <td align="right">
                <label for="bug_file_loc" accesskey="u"><b>
                    <u>U</u>RL</b></label>:
              </td><td colspan="2">
       <input type="hidden" name="bug_file_loc" id="bug_file_loc"
              value="">
  </td>
            </tr>

              <tr>
                <td align="right">
                  <label for="status_whiteboard" accesskey="w"><b><u>W</u>hiteboard</b></label>:
                </td><td colspan="2">
       <input type="hidden" name="status_whiteboard" id="status_whiteboard"
              value="">
  </td>
              </tr>

              <tr>
                <td align="right">
                  <label for="keywords" accesskey="k">
                    <b><a href="https://www.mozdev.org/bugs/describekeywords.cgi"><u>K</u>eywords</a></b></label>:
                </td><td colspan="2">
       <input type="hidden" name="keywords" id="keywords"
              value="">
  </td>
              </tr>

            


            

            <tr><th align="right">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>
  </td>
  <td>
      <input type="hidden" id="dependson" name="dependson"
             value="">
  </td>
            </tr>

            <tr><th align="right">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>
  </td>
  <td>
      <input type="hidden" id="blocked" name="blocked"
             value="">
  </td>
            </tr>

            <tr>
              <th>&nbsp;</th>

              <td colspan="2">
                <a href="https://www.mozdev.org/bugs/showdependencytree.cgi?id=26276&amp;hide_resolved=1">Show
                   dependency tree</a>

                  - <a href="https://www.mozdev.org/bugs/showdependencygraph.cgi?id=26276">Show
                       dependency graph</a>
              </td>
            </tr>
          </table>
        </fieldset>
      </td>

      
      <script type="text/javascript">
        <!--
        var v = document.body.offsetHeight;
        //-->
      </script>

      <td valign="top">
        
        <fieldset>
          <legend>People</legend><table cellpadding="1" cellspacing="1">
    <tr>
      <td align="right">
        <b>Reporter</b>:
      </td>
      <td>
        <a href="mailto:vitaly&#64;easycoding.org">Vitaly Zaitsev &lt;vitaly&#64;easycoding.org&gt;</a>
      </td>
    </tr>

    <tr>
      <td align="right">
        <b><a href="https://www.mozdev.org/bugs/page.cgi?id=fields.html#assigned_to">Assigned&nbsp;To</a></b>:
      </td>
      <td>
        <a href="mailto:axel.grude&#64;gmail.com">Axel Grude &lt;axel.grude&#64;gmail.com&gt;</a>
      </td>
    </tr>



    <tr>
        <td align="right" valign="top">
          <label for="cc"><b>CC</b></label>:
        </td>
        <td valign="top">
          <select id="cc" name="cc" multiple="multiple" size="5">
            <option value="macej.peter&#64;gmail.com">macej.peter&#64;gmail.com</option>
            <option value="nazir.cz&#64;gmail.com">nazir.cz&#64;gmail.com</option>
            <option value="vitaly&#64;easycoding.org">vitaly&#64;easycoding.org</option>
          </select>
        </td>
    </tr>
  </table>
        </fieldset>

        
      </td>
    </tr>
  </table>



<script type="text/javascript">
  <!--
  function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var rows = table.getElementsByTagName("tr");
    var originalHeight = table.offsetHeight; // Store current height for scrolling

    var toggle;
    if (link.innerHTML == "Show Obsolete") {
      toggle = ""; // This should be 'table-row', but IE 6 doesn't understand it.
      link.innerHTML = "Hide Obsolete";
    }
    else {
      toggle = "none";
      link.innerHTML = "Show Obsolete";
    }

    for (var i = 0; i < rows.length; i++) {
      if (rows[i].className.match('bz_tr_obsolete'))
        rows[i].style.display = toggle;
    }

    var newHeight = table.offsetHeight;
    window.scrollBy(0, newHeight - originalHeight);

    return false;
  }
  //-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr>
    <th colspan="3" align="left">
      <a name="a0" id="a0">Attachments</a>
    </th>
  </tr>


      <tr class="
                 ">
        <td valign="top">
            <a name="a1" href="smartTemplate-1.3.1pre8.xpi"
               title="View the content of the attachment">
          <b>1.3.1 prerelease 8</b></a>

          <span class="bz_attach_extra_info">
              (380.92 KB,
                application/x-xpinstall)

            <br>
            <a href="show_bug.cgi@id=26276.html#attach_8232"
               title="Go to the comment associated with the attachment">2016-09-12 11:09</a>,

            <a href="mailto:axel.grude&#64;gmail.com"
               title="Write an email to the creator of the attachment">Axel Grude
            </a>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">
              <i>no flags</i>
          </td>

        <td valign="top">
          <a href="https://www.mozdev.org/bugs/attachment.cgi?id=8232&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
        </span>
      <a href="https://www.mozdev.org/bugs/attachment.cgi?bugid=26276&amp;action=enter">Add an attachment</a>
      (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>




  <br>
  <table cellpadding="1" cellspacing="1">
    <tr>
      <td>
          <fieldset>
            <legend>Note</legend>
            <p>
              You need to
              <a href="https://www.mozdev.org/bugs/show_bug.cgi?id=26276&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </p>
          </fieldset>
      </td>

      <td valign="top">
        <fieldset>
          <legend>Related actions</legend>
          <ul>
            <li><a href="https://www.mozdev.org/bugs/show_activity.cgi?id=26276">View Bug Activity</a></li>
            <li><a href="https://www.mozdev.org/bugs/show_bug.cgi?format=multiple&amp;id=26276">Format For Printing</a></li>
            <li><a href="https://www.mozdev.org/bugs/show_bug.cgi?ctype=xml&amp;id=26276">XML</a></li>
            <li><a href="https://www.mozdev.org/bugs/enter_bug.cgi?cloned_bug_id=26276">Clone This Bug</a></li>
          </ul>


          
        </fieldset>
      </td>
    </tr>
  </table>
  <br>





<hr>

<div id="comments"><script type="text/javascript">
  <!--
  function updateCommentPrivacy(checkbox, id) {
    var comment_elem = document.getElementById('comment_text_'+id).parentNode;
    if (checkbox.checked) {
      if (!comment_elem.className.match('bz_private')) {
        comment_elem.className = comment_elem.className.concat(' bz_private');
      }
    }
    else {
      comment_elem.className =
        comment_elem.className.replace(/(\s*|^)bz_private(\s*|$)/, '$2');
    }
  }
  //-->
  </script>








<div class="bz_comment">
        <table>
          <tr>
            <th align="left">
              <b><a name="c0" href="show_bug.cgi@id=26276.html#c0">
                Description</a>:</b>&nbsp;&nbsp;
            </th>
            <td align="left" width="30%">
              <b>Opened:</b> 2016-08-21 11:37
            </td>
          </tr>
        </table>
        


<pre class="bz_comment_text" >Reply template is not working in version 1.3+. Under 1.2.x it works fine.
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c1" href="show_bug.cgi@id=26276.html#c1">
            #1</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-08-22 02:37:50 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >PLease provide the following info:

0. Are you replying in HTML or plain text?

1. Your Quote header

2. Your Template

3. Settings:
[x] Use instead of default quote header
[x] Use HTML
[ ] Replace line breaks with &lt;br&gt;

4. Global Settings:
[x] Replace SIgnature
[x] Process Signature
[x] Replace line breaks in plain text sig

[x] Force Paragraph Mode


You can use JavaScript Error console (CTRL+SHIFT+J) to see if any new errors
are reported during opening the composer window.
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c2" href="show_bug.cgi@id=26276.html#c2">
            #2</a> From 
          <a href="mailto:vitaly&#64;easycoding.org">Vitaly Zaitsev</a>
          2016-08-22 05:03:23 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" ><span class="quote">&gt; 0. Are you replying in HTML or plain text?</span >

Plain text.

<span class="quote">&gt; 1. Your Quote header</span >

Hello, %from(name)%.

%date% you wrote:

<span class="quote">&gt; [x] Use instead of default quote header</span >

Checked.

<span class="quote">&gt; [x] Use HTML</span >

I'm not using HTML messages at all. Checked for test. Same.

<span class="quote">&gt; 4. Global Settings:
&gt; [x] Replace SIgnature
&gt; [x] Process Signature
&gt; [x] Replace line breaks in plain text sig</span >

All three checked.

<span class="quote">&gt; [x] Force Paragraph Mode</span >

Checked.

<span class="quote">&gt; You can use JavaScript Error console (CTRL+SHIFT+J) to see if any new errors</span >

No erros, just messages:

Mon Aug 22 2016 15:00:36 GMT+0300 CH: messagePaneBoxFocus start
Mon Aug 22 2016 15:00:36 GMT+0300 CH: messagePaneBoxFocus stop
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c3" href="show_bug.cgi@id=26276.html#c3">
            #3</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-08-22 07:31:53 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi@id=26276.html#c2">comment #2</a>)
<span class="quote">&gt; &gt; 0. Are you replying in HTML or plain text?
&gt; 
&gt; Plain text.
&gt; 
&gt; &gt; 1. Your Quote header
&gt; 
&gt; Hello, %from(name)%.
&gt; 
&gt; %date% you wrote:
&gt; </span >

For testing I am going to assume what you are doing is this:

1 - Quote Header:
%date% you wrote:

2 - Template:
Hello, %from(name)%.

===
...because that's what each part is. quote header is basically whats _always on
top_ of the quote block

The Template represents your &quot;writing area&quot; - basically its the stationery that
you write on. Whether this is before or after the quote depends on account
settings &gt; Composition and Addressing


Now I tested with 2 settings

&quot;start my reply above the quote&quot;
and
&quot;start my reply below the quote&quot;

which both worked for me. When the email is created the cursor is dropped
straight below the &quot;Hello, name.&quot;

What are you getting in your new email, any words at all? Only the quoted
email? or just things appearing in the wrong / unexpected space? Note that the
two words &quot;Is broken&quot; doesn't really help me to get a picture of what is
happening. It could mean that composer is not loading at all, or that
everything is perfect except for the name being replaced or an infinite other
possible results. If you like, attach the text of a generated email replying to
a simple test message _without editing it_ straight after composer shows it.
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c4" href="show_bug.cgi@id=26276.html#c4">
            #4</a> From 
          <a href="mailto:vitaly&#64;easycoding.org">Vitaly Zaitsev</a>
          2016-08-22 07:45:15 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" ><span class="quote">&gt; What are you getting in your new email, any words at all? Only the quoted</span >
email?

I see only quoted text in new Email window. No quote header at all.

<span class="quote">&gt; It could mean that composer is not loading at all, or that</span >
everything is perfect except for the name being replaced or an infinite other
possible results. If you like, attach the text of a generated email replying to
a simple test message _without editing it_ straight after composer shows it.

<a href="http://paste.fedoraproject.org/412485/18770841/">http://paste.fedoraproject.org/412485/18770841/</a>
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c5" href="show_bug.cgi@id=26276.html#c5">
            #5</a> From 
          <a href="mailto:vitaly&#64;easycoding.org">Vitaly Zaitsev</a>
          2016-08-22 07:47:22 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >Same templates but on SmartTemplate version 1.2.1:
<a href="http://paste.fedoraproject.org/412490/18771971/">http://paste.fedoraproject.org/412490/18771971/</a>
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c6" href="show_bug.cgi@id=26276.html#c6">
            #6</a> From 
          <a href="mailto:macej.peter&#64;gmail.com">PeterM</a>
          2016-09-09 05:03:26 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >I'm experiencing the same problem. When I reply in plain text mode (my
default), the problem occurs. When I reply in HTML mode (with Shift + Reply
button) it works.

I debugged the code and found that in Reply mode you look for BLOCKQUOTE tag.
This tag doesn't exist in a plain text reply message, only in HTML reply
message.

So I replaced the code in smartTemplate-compose.js:
let firstQuote =                                           
  (composeCase=='forward') ?                               
        editor.rootElement.firstChild :                          
  editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0];

with:
let firstQuote =                                           
  (composeCase=='forward') ?                               
        editor.rootElement.firstChild :                          
  (editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] ?
editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] :
editor.rootElement.firstChild);

and it works.
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c7" href="show_bug.cgi@id=26276.html#c7">
            #7</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-09-09 06:40:03 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi@id=26276.html#c6">comment #6</a>)
<span class="quote">&gt; I'm experiencing the same problem. When I reply in plain text mode (my
&gt; default), the problem occurs. When I reply in HTML mode (with Shift + Reply
&gt; button) it works.
&gt; 
&gt; I debugged the code and found that in Reply mode you look for BLOCKQUOTE tag.
&gt; This tag doesn't exist in a plain text reply message, only in HTML reply
&gt; message.
&gt; 
&gt; So I replaced the code in smartTemplate-compose.js:
&gt; let firstQuote =                                           
&gt;   (composeCase=='forward') ?                               
&gt;         editor.rootElement.firstChild :                          
&gt;   editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0];
&gt; 
&gt; with:
&gt; let firstQuote =                                           
&gt;   (composeCase=='forward') ?                               
&gt;         editor.rootElement.firstChild :                          
&gt;   (editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] ?
&gt; editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] :
&gt; editor.rootElement.firstChild);
&gt; 
&gt; and it works.
&gt; </span >

Thanks for doing the leg work.  I am out over the weekend but will review the
code when I am back home. Hope using firstchild is sufficient for all
positioning cases.
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c8" href="show_bug.cgi@id=26276.html#c8">
            #8</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-09-12 11:07:15 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi@id=26276.html#c7">comment #7</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi@id=26276.html#c6">comment #6</a>)
&gt; &gt; I'm experiencing the same problem. When I reply in plain text mode (my
&gt; &gt; default), the problem occurs. When I reply in HTML mode (with Shift + Reply
&gt; &gt; button) it works.
&gt; &gt; 
&gt; &gt; I debugged the code and found that in Reply mode you look for BLOCKQUOTE tag.
&gt; &gt; This tag doesn't exist in a plain text reply message, only in HTML reply
&gt; &gt; message.
&gt; &gt; 
&gt; &gt; So I replaced the code in smartTemplate-compose.js:
&gt; &gt; let firstQuote =                                           
&gt; &gt;   (composeCase=='forward') ?                               
&gt; &gt;         editor.rootElement.firstChild :                          
&gt; &gt;   editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0];
&gt; &gt; 
&gt; &gt; with:
&gt; &gt; let firstQuote =                                           
&gt; &gt;   (composeCase=='forward') ?                               
&gt; &gt;         editor.rootElement.firstChild :                          
&gt; &gt;   (editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] ?
&gt; &gt; editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0] :
&gt; &gt; editor.rootElement.firstChild);
&gt; &gt; 
&gt; &gt; and it works.
&gt; &gt; 
&gt; 
&gt; Thanks for doing the leg work.  I am out over the weekend but will review the
&gt; code when I am back home. Hope using firstchild is sufficient for all
&gt; positioning cases.
&gt; </span >
hmm, just checked my source code it is starting from line 1004:

let firstQuote = 
  (composeCase=='forward') ?
  editor.rootElement.firstChild :
  editor.rootElement.getElementsByTagName('BLOCKQUOTE')[0];

if (!firstQuote) firstQuote = editor.rootElement.firstChild;

but may be related to [<span class="bz_closed"><a href="show_bug.cgi@id=26261.html" title="RESOLVED FIXED - Quote header not inserted in plain text mode">Bug 26261</a></span>]. Posting a patch here next
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c9" href="show_bug.cgi@id=26276.html#c9">
            #9</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-09-12 11:08:22 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" >

*** This bug has been marked as a duplicate of <span class="bz_closed"><a href="show_bug.cgi@id=26261.html" title="RESOLVED FIXED - Quote header not inserted in plain text mode">bug 26261</a></span> ***
</pre>
    </div>
  <div class="bz_comment">
        <span class="bz_comment_head">
          <span class="comment_rule">-------</span> <i>Comment
          <a name="c10" href="show_bug.cgi@id=26276.html#c10">
            #10</a> From 
          <a href="mailto:axel.grude&#64;gmail.com">Axel Grude</a>
          2016-09-12 11:09:54 
          </i>
          <span class="comment_rule">-------</span>
        </span>
        


<pre class="bz_comment_text" ><span class=""><a href="smartTemplate-1.3.1pre8.xpi" name="attach_8232" title="1.3.1 prerelease 8">Created an attachment (id=8232)</a> <a href="https://www.mozdev.org/bugs/attachment.cgi?id=8232&amp;action=edit" title="1.3.1 prerelease 8">[details]</a></span>
1.3.1 prerelease 8

fallback for p[lain text case
</pre>
    </div>
</div>

</form>

<hr>
<i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions">
    <div class="label">Actions: </div><ul class="links">
  <li><a href="https://www.mozdev.org/bugs/">Home</a></li>
  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="https://www.mozdev.org/bugs/buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_bottom"></form></li>

  <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/report.cgi">Reports</a></li>

  <li>
    <span class="separator">| </span>
      <a href="https://www.mozdev.org/bugs/request.cgi">Requests</a></li>


      <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/createaccount.cgi">New&nbsp;Account</a></li>
      



      

        
      <li><span class="separator">| </span><a href="https://www.mozdev.org/bugs/show_bug.cgi?id=26276&amp;GoAheadAndLogIn=1">Log&nbsp;In</a></li>
</ul>
  </li>

  
    
    
    

  


  
</ul>

  <div class="outro"></div>
</div>

</body>
</html>